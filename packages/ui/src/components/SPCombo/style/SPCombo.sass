@use 'sass:selector'
@use 'sass:math'
@use '@theme/src/material/settings' as settings;
@use '@theme/src/material/tools' as tools;
@use './_vars' as *
@use '../../SPSelect/style/mixins' as *

@include tools.layer('components')
  .sp-combo
    @include select-compact-tag-label

    .sp-field
      .sp-text-field__prefix,
      .sp-text-field__suffix,
      .sp-field__input,
      &.sp-field
        cursor: text

    .sp-field
      .sp-field__input
        > input
          flex: 1 1

    .sp-field
      input
        min-width: $combo-focused-input

      &:not(.sp-field--focused)
        input
          min-width: 0

    .sp-field--dirty
      .sp-combo__selection
        margin-inline-end: $combo-selection-gap

    .sp-combo__selection-text
      overflow: hidden
      text-overflow: ellipsis
      white-space: nowrap

  .sp-combo
    &__content
      overflow: hidden

      @include tools.elevation($combo-content-elevation)
      @include tools.rounded($combo-content-border-radius)

    &__mask
      background: rgb(var(--v-theme-surface-light))

    &__selection
      display: inline-flex
      align-items: center
      height: calc($input-font-size * $input-line-height)
      letter-spacing: inherit
      line-height: inherit
      max-width: calc(100% - $combo-selection-gap - $combo-input-buffer)

    &__selection
      &:first-child
        margin-inline-start: 0

    &--selecting-index
      .sp-combo__selection
        opacity: var(--v-medium-emphasis-opacity)

        &--selected
          opacity: 1

      .sp-field__input > input
        caret-color: transparent

    &--single:not(.sp-combo--selection-slot)
      &.sp-text-field input
        flex: 1 1
        position: absolute
        left: 0
        right: 0
        width: 100%
        padding-inline: inherit

      .sp-field--active
        input
          transition: none

      .sp-field--dirty:not(.sp-field--focused)
        input
          opacity: 0

      .sp-field--focused
        .sp-combo__selection
          opacity: 0

    &__menu-icon
      margin-inline-start: 4px
      transition: $combo-transition

      .sp-combo--active-menu &
        transform: rotate(180deg)
